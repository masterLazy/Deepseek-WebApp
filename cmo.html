<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金牌教练模拟器 v2.0.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 3px solid var(--primary);
            position: relative;
        }

        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.3rem;
            font-weight: 500;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .game-info:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .student-info {
            flex: 1;
            padding-right: 20px;
        }

        .student-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2.5rem;
            margin: 0 auto 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 4px solid white;
        }

        .student-name {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .stats-box {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            flex: 1;
            margin: 0 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }

        .stats-box:hover {
            transform: translateY(-3px);
        }

        .stats-box h4 {
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stats-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .attributes {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .attribute {
            display: flex;
            align-items: center;
        }

        .attribute-name {
            width: 100px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
        }

        .attribute-name i {
            margin-right: 8px;
            color: var(--primary);
        }

        .attribute-bar {
            flex: 1;
            height: 20px;
            background-color: var(--light-gray);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 15px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .attribute-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s;
        }

        .calculation-fill {
            background: linear-gradient(to right, #3498db, #2980b9);
        }

        .insight-fill {
            background: linear-gradient(to right, #2ecc71, #27ae60);
        }

        .creativity-fill {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
        }

        .logic-fill {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        .memory-fill {
            background: linear-gradient(to right, #f39c12, #d35400);
        }

        .attribute-value {
            width: 40px;
            text-align: center;
            font-weight: bold;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .competition-info {
            background: linear-gradient(135deg, #e8f4fd, #d6eaf8);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border-left: 5px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .competition-info h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }

        .competition-info h3 i {
            margin-right: 10px;
        }

        .actions {
            margin-bottom: 30px;
            text-align: center;
        }

        .action-button {
            padding: 18px 30px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.3);
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(67, 97, 238, 0.4);
            background: linear-gradient(to right, var(--secondary), var(--primary));
        }

        .action-button:active {
            transform: translateY(2px);
        }

        .action-button i {
            margin-right: 10px;
        }

        .coach-actions {
            margin-bottom: 30px;
            text-align: center;
        }

        .coach-actions h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.4rem;
        }

        .coach-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .coach-button {
            padding: 15px 25px;
            background: linear-gradient(to right, #e67e22, #d35400);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 6px 12px rgba(230, 126, 34, 0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            min-width: 180px;
        }

        .coach-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(230, 126, 34, 0.4);
        }

        .coach-button:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .coach-button i {
            margin-right: 8px;
        }

        .events {
            margin-bottom: 30px;
        }

        .events h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
        }

        .events h3 i {
            margin-right: 10px;
            color: var(--primary);
        }

        .event-log {
            background-color: white;
            border: 1px solid var(--light-gray);
            border-radius: 15px;
            padding: 20px;
            height: 250px;
            overflow-y: auto;
            margin-top: 10px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .event-entry {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--light-gray);
            animation: fadeIn 0.5s;
            display: flex;
            align-items: flex-start;
        }

        .event-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .event-icon {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .positive {
            color: #27ae60;
            font-weight: 600;
        }

        .negative {
            color: #e74c3c;
            font-weight: 600;
        }

        .special {
            color: #8e44ad;
            font-weight: 600;
        }

        .milestones {
            margin-bottom: 30px;
        }

        .milestones h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
        }

        .milestones h3 i {
            margin-right: 10px;
            color: var(--primary);
        }

        .milestone-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .milestone {
            background-color: white;
            padding: 18px;
            border-radius: 12px;
            flex: 1;
            min-width: 140px;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .milestone:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .milestone:hover:before {
            transform: scaleX(1);
        }

        .milestone.completed {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(46, 204, 113, 0.3);
        }

        .phase-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .phase {
            flex: 1;
            text-align: center;
            padding: 18px;
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            margin: 0 8px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .phase:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .phase.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(67, 97, 238, 0.3);
        }

        .phase.active:before {
            transform: scaleX(1);
        }

        .phase.completed {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }

        .modal-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray);
            transition: color 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-button:hover {
            color: var(--danger);
            background-color: var(--light-gray);
        }

        .modal-body {
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .modal-button {
            padding: 12px 25px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-button:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .modal-button.primary {
            background: linear-gradient(to right, var(--success), #4cc9f0);
        }

        .modal-button.primary:hover {
            background: linear-gradient(to right, #4cc9f0, var(--success));
        }

        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .action-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .action-card.selected {
            border-color: var(--success);
            background-color: #f0f9ff;
            transform: translateY(-5px);
        }

        .action-card h4 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .action-card h4 i {
            margin-right: 10px;
            color: var(--primary);
        }

        .action-card p {
            color: var(--gray);
            font-size: 0.95rem;
            flex-grow: 1;
        }

        .action-card .intensity {
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            align-items: center;
        }

        .action-card .intensity i {
            margin-right: 5px;
            color: var(--warning);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        .result-card.positive {
            border-left: 5px solid var(--success);
        }

        .result-card.negative {
            border-left: 5px solid var(--danger);
        }

        .result-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .result-value.positive {
            color: var(--success);
        }

        .result-value.negative {
            color: var(--danger);
        }

        .game-over {
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            margin-top: 30px;
            display: none;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .game-over h2 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .game-over p {
            font-size: 1.3rem;
            margin-bottom: 30px;
            color: var(--gray);
            line-height: 1.8;
        }

        .restart-button {
            padding: 18px 35px;
            background: linear-gradient(to right, var(--success), #4cc9f0);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 600;
            box-shadow: 0 8px 16px rgba(76, 201, 240, 0.3);
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .restart-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(76, 201, 240, 0.4);
            background: linear-gradient(to right, #4cc9f0, var(--success));
        }

        .restart-button i {
            margin-right: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .warning {
            color: var(--danger);
            font-weight: bold;
            margin-top: 10px;
            padding: 15px;
            background-color: #ffe6e6;
            border-radius: 10px;
            border-left: 4px solid var(--danger);
        }

        .time-display {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .health-display,
        .willpower-display {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .health-display {
            color: #1abc9c;
        }

        .willpower-display {
            color: #9b59b6;
        }

        /* 对话弹窗样式 */
        .dialogue-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dialogue-box {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }

        .dialogue-speaker {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .dialogue-speaker i {
            margin-right: 8px;
        }

        .dialogue-content {
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--dark);
        }

        .dialogue-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .dialogue-option {
            background-color: white;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
            text-align: left;
        }

        .dialogue-option:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .dialogue-option.correct {
            border-color: var(--success);
            background-color: rgba(76, 201, 240, 0.1);
        }

        .dialogue-option.incorrect {
            border-color: var(--danger);
            background-color: rgba(247, 37, 133, 0.1);
        }

        /* 响应式设计 */
        @media (max-width: 992px) {
            .game-info {
                flex-direction: column;
            }

            .student-info {
                padding-right: 0;
                margin-bottom: 20px;
            }

            .stats-container {
                justify-content: space-around;
            }

            .milestone-list {
                justify-content: center;
            }

            .milestone {
                min-width: 160px;
            }

            .phase-indicator {
                flex-wrap: wrap;
            }

            .phase {
                margin-bottom: 10px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2.2rem;
            }

            .action-grid {
                grid-template-columns: 1fr;
            }

            .coach-buttons {
                flex-direction: column;
            }

            .coach-button {
                min-width: auto;
            }

            .stats-container {
                flex-direction: column;
                gap: 10px;
            }

            .stats-box {
                margin: 0;
            }

            .result-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dialogue-options {
                gap: 8px;
            }

            .dialogue-option {
                padding: 12px;
            }
        }

        @media (max-width: 576px) {
            .modal-content {
                padding: 20px;
            }

            .action-button {
                padding: 15px 25px;
                font-size: 1.1rem;
            }

            .restart-button {
                padding: 15px 25px;
                font-size: 1.1rem;
            }

            .phase-indicator {
                flex-direction: column;
            }

            .phase {
                margin: 0 0 10px 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-trophy"></i> 金牌教练模拟器</h1>
            <p class="subtitle">在高中三年内，培养出一位获得国际数学奥林匹克（IMO）金牌的学生</p>
        </header>

        <div class="phase-indicator">
            <div class="phase" id="phase-1"><i class="fas fa-user-graduate"></i> 高一阶段</div>
            <div class="phase" id="phase-2"><i class="fas fa-user-graduate"></i> 高二阶段</div>
            <div class="phase" id="phase-3"><i class="fas fa-user-graduate"></i> 高三阶段</div>
        </div>

        <div class="game-info">
            <div class="student-info">
                <div class="student-avatar">陈</div>
                <div class="student-name">cmo_UwU</div>
                <p class="time-display"><i class="far fa-clock"></i> 时间：<span id="time-display">高一上学期 9月</span></p>
                <p class="willpower-display"><i class="fas fa-brain"></i> 意志力：<span id="willpower-display">5.0</span>/10
                </p>
                <p class="health-display"><i class="fas fa-heartbeat"></i> 健康值：<span id="health-display">8.0</span>/10
                </p>
                <div class="stats-container">
                    <div class="stats-box">
                        <h4><i class="fas fa-dumbbell"></i> 训练强度</h4>
                        <div class="stats-value" id="training-intensity">5.0</div>
                    </div>
                    <div class="stats-box">
                        <h4><i class="fas fa-handshake"></i> 师生关系</h4>
                        <div class="stats-value" id="relationship-value">7.0</div>
                    </div>
                </div>
            </div>

            <div class="attributes">
                <div class="attribute">
                    <div class="attribute-name"><i class="fas fa-calculator"></i> 计算力</div>
                    <div class="attribute-bar">
                        <div class="attribute-fill calculation-fill" id="calculation-fill" style="width: 40%;"></div>
                    </div>
                    <div class="attribute-value" id="calculation-value">4.0</div>
                </div>

                <div class="attribute">
                    <div class="attribute-name"><i class="fas fa-eye"></i> 洞察力</div>
                    <div class="attribute-bar">
                        <div class="attribute-fill insight-fill" id="insight-fill" style="width: 30%;"></div>
                    </div>
                    <div class="attribute-value" id="insight-value">3.0</div>
                </div>

                <div class="attribute">
                    <div class="attribute-name"><i class="fas fa-lightbulb"></i> 创造力</div>
                    <div class="attribute-bar">
                        <div class="attribute-fill creativity-fill" id="creativity-fill" style="width: 20%;"></div>
                    </div>
                    <div class="attribute-value" id="creativity-value">2.0</div>
                </div>

                <div class="attribute">
                    <div class="attribute-name"><i class="fas fa-project-diagram"></i> 逻辑思维</div>
                    <div class="attribute-bar">
                        <div class="attribute-fill logic-fill" id="logic-fill" style="width: 25%;"></div>
                    </div>
                    <div class="attribute-value" id="logic-value">2.5</div>
                </div>

                <div class="attribute">
                    <div class="attribute-name"><i class="fas fa-memory"></i> 记忆力</div>
                    <div class="attribute-bar">
                        <div class="attribute-fill memory-fill" id="memory-fill" style="width: 35%;"></div>
                    </div>
                    <div class="attribute-value" id="memory-value">3.5</div>
                </div>
            </div>
        </div>

        <div class="competition-info">
            <h3><i class="fas fa-flag-checkered"></i> 即将到来的比赛</h3>
            <p id="next-competition">校内选拔赛 - 11月</p>
            <p id="competition-requirements">要求：计算力 ≥ 5，洞察力 ≥ 4</p>
        </div>

        <div class="actions">
            <button class="action-button" id="action-button"><i class="fas fa-tasks"></i> 选择本月行动</button>
        </div>

        <div class="coach-actions">
            <h3><i class="fas fa-chalkboard-teacher"></i> 教练技能（每学期可使用一次）</h3>
            <div class="coach-buttons">
                <button class="coach-button" id="coach-training"><i class="fas fa-user-friends"></i> 一对一特训</button>
                <button class="coach-button" id="coach-mindset"><i class="fas fa-brain"></i> 心态调整</button>
                <button class="coach-button" id="coach-analysis"><i class="fas fa-chart-line"></i> 战术分析</button>
                <button class="coach-button" id="coach-rest"><i class="fas fa-bed"></i> 强制休息</button>
            </div>
        </div>

        <div class="events">
            <h3><i class="fas fa-newspaper"></i> 事件日志</h3>
            <div class="event-log" id="event-log">
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-info-circle"></i></div>
                    <div>欢迎来到金牌教练模拟器！你接收了一位有潜力的高一学生cmo_UwU，请开始你的教练生涯。</div>
                </div>
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-bullseye"></i></div>
                    <div>目标：在三年内培养出一位IMO金牌选手。</div>
                </div>
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div>注意：学生的健康值和意志力会影响训练效果，请合理安排训练和休息。</div>
                </div>
            </div>
        </div>

        <div class="milestones">
            <h3><i class="fas fa-medal"></i> 竞赛之路</h3>
            <div class="milestone-list">
                <div class="milestone" id="milestone-1">校内选拔赛</div>
                <div class="milestone" id="milestone-2">市级竞赛</div>
                <div class="milestone" id="milestone-3">省级联赛</div>
                <div class="milestone" id="milestone-4">全国联赛</div>
                <div class="milestone" id="milestone-5">中国数学奥林匹克</div>
                <div class="milestone" id="milestone-6">国家队选拔</div>
                <div class="milestone" id="milestone-7">国际数学奥林匹克</div>
            </div>
        </div>

        <div class="game-over" id="game-over">
            <h2 id="game-result">游戏结束</h2>
            <p id="game-description"></p>
            <button class="restart-button" id="restart-button"><i class="fas fa-redo"></i> 重新开始</button>
        </div>
    </div>

    <!-- 行动选择弹窗 -->
    <div class="modal" id="action-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-tasks"></i> 选择本月行动</h2>
                <button class="close-button" id="close-action-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>请为cmo_UwU选择本月的训练计划（最多选择2项）：</p>
                <div class="action-grid" id="action-grid">
                    <!-- 行动选项将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="confirm-actions">确认选择</button>
            </div>
        </div>
    </div>

    <!-- 月度结果弹窗 -->
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-chart-bar"></i> 月度总结</h2>
                <button class="close-button" id="close-result-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="result-content">
                    <!-- 结果内容将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button primary" id="continue-button">继续</button>
            </div>
        </div>
    </div>

    <!-- 竞赛结果弹窗 -->
    <div class="modal" id="competition-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="competition-title"><i class="fas fa-trophy"></i> 竞赛结果</h2>
                <button class="close-button" id="close-competition-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="competition-content">
                    <!-- 竞赛结果内容将通过JavaScript动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button primary" id="competition-continue">继续</button>
            </div>
        </div>
    </div>

    <!-- 对话弹窗 -->
    <div class="modal" id="dialogue-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-comments"></i> 师生对话</h2>
                <button class="close-button" id="close-dialogue-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dialogue-content">
                    <!-- 对话内容将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            year: 1, // 1-3: 高一到高三
            month: 9, // 9-8: 9月到次年8月
            calculation: 4,
            insight: 3,
            creativity: 2,
            logic: 2.5,
            memory: 3.5,
            willpower: 5,
            health: 8,
            trainingIntensity: 5,
            relationship: 7,
            selectedActions: [],
            coachActionsUsed: {
                training: false,
                mindset: false,
                analysis: false,
                rest: false
            },
            milestones: {
                school: false,
                city: false,
                provincial: false,
                national: false,
                cmo: false,
                team: false,
                imo: false
            },
            gameActive: true,
            competitionResults: [],
            dialogueTriggered: false  // 标记对话是否已触发
        };

        // 行动定义
        const actions = [
            {
                id: 'basic',
                name: '基础理论深耕',
                description: '刷《奥数教程》、《小蓝本》等基础教材，巩固数学基础。',
                icon: 'fas fa-book',
                effects: { calculation: 0.8, insight: 0.7, logic: 0.5, willpower: -0.8, health: -0.3 },
                intensity: 7
            },
            {
                id: 'algebra',
                name: '专题突破：代数',
                description: '集中攻克代数模块，提升代数解题能力。',
                icon: 'fas fa-superscript',
                effects: { calculation: 1.5, logic: 0.8, willpower: -0.5, health: -0.2 },
                intensity: 6
            },
            {
                id: 'geometry',
                name: '专题突破：几何',
                description: '集中攻克几何模块，提升几何证明能力。',
                icon: 'fas fa-draw-polygon',
                effects: { insight: 1.5, logic: 0.7, willpower: -0.6, health: -0.2 },
                intensity: 6
            },
            {
                id: 'number',
                name: '专题突破：数论',
                description: '集中攻克数论模块，提升数论问题解决能力。',
                icon: 'fas fa-infinity',
                effects: { insight: 1.0, creativity: 1.0, logic: 0.5, willpower: -0.7, health: -0.3 },
                intensity: 7
            },
            {
                id: 'combo',
                name: '专题突破：组合',
                description: '集中攻克组合模块，提升组合构造能力。',
                icon: 'fas fa-puzzle-piece',
                effects: { creativity: 1.5, logic: 0.6, willpower: -0.8, health: -0.3 },
                intensity: 7
            },
            {
                id: 'exam',
                name: '模拟考试风暴',
                description: '进行4.5小时的全真模拟考试，全面检验学习成果。',
                icon: 'fas fa-file-alt',
                effects: { calculation: 0.5, insight: 0.5, creativity: 0.5, logic: 0.5, memory: 0.5, willpower: -1.2, health: -0.5 },
                intensity: 9
            },
            {
                id: 'past',
                name: '真题剖析研究',
                description: '研究近十年的IMO、CMO真题，了解出题风格。',
                icon: 'fas fa-history',
                effects: { insight: 0.8, creativity: 0.8, memory: 0.7, willpower: -0.4 },
                intensity: 5
            },
            {
                id: 'light',
                name: '轻松训练',
                description: '进行中等强度的训练，平衡学习和休息。',
                icon: 'fas fa-walking',
                effects: { calculation: 0.3, insight: 0.3, creativity: 0.3, willpower: 0.2, health: 0.2 },
                intensity: 3
            },
            {
                id: 'rest',
                name: '心理与体能调节',
                description: '进行体育运动、心理咨询或放假一天，恢复意志力。',
                icon: 'fas fa-bed',
                effects: { willpower: 2.5, health: 1.5, relationship: 0.5 },
                intensity: 1
            }
        ];

        // 随机事件
        const randomEvents = {
            positive: [
                {
                    text: "灵光一闪！学生在思考一个复杂数论题时，突然找到了精妙的证明。",
                    effect: { creativity: 1.5, logic: 0.5 },
                    icon: "fas fa-lightbulb"
                },
                {
                    text: "良师益友：遇到一位优秀的学长，相互切磋，能力全面提升。",
                    effect: { calculation: 0.5, insight: 0.5, creativity: 0.5, relationship: 0.5 },
                    icon: "fas fa-users"
                },
                {
                    text: "教练的肯定：你的一次关键指导让学生豁然开朗，信心大增。",
                    effect: { willpower: 1.5, relationship: 0.8 },
                    icon: "fas fa-chalkboard-teacher"
                },
                {
                    text: "突破瓶颈：学生成功突破了一个长期困扰的难题，能力大幅提升。",
                    effect: { calculation: 0.8, insight: 0.8, willpower: 1.0 },
                    icon: "fas fa-rocket"
                },
                {
                    text: "高效学习：学生找到了适合自己的学习方法，效率大幅提升。",
                    effect: { calculation: 0.5, insight: 0.5, creativity: 0.5, memory: 0.5 },
                    icon: "fas fa-bolt"
                },
                {
                    text: "名师指点：有机会参加一位著名数学家的讲座，受益匪浅。",
                    effect: { insight: 1.0, creativity: 1.0, logic: 0.5 },
                    icon: "fas fa-user-graduate"
                }
            ],
            negative: [
                {
                    text: "瓶颈期：连续数周无法突破某个难点，感到沮丧。",
                    effect: { willpower: -2.0, relationship: -0.5 },
                    icon: "fas fa-tired"
                },
                {
                    text: "伤病困扰：因长时间伏案导致颈椎不适，本月训练效率减半。",
                    effect: { calculation: -0.5, insight: -0.5, health: -1.5 },
                    icon: "fas fa-procedures"
                },
                {
                    text: "外界诱惑：同学邀请参加碰碰车大战，分散了注意力。",
                    effect: { willpower: -1.5, health: -3.0 },
                    icon: "fas fa-gamepad"
                },
                {
                    text: "家庭压力：家长对竞赛成绩不满意，施加压力。",
                    effect: { willpower: -1.0, relationship: -0.5 },
                    icon: "fas fa-home"
                },
                {
                    text: "学习疲劳：连续高强度训练导致学习效率下降。",
                    effect: { calculation: -0.3, insight: -0.3, creativity: -0.3, willpower: -1.0 },
                    icon: "fas fa-tired"
                },
                {
                    text: "感冒发烧：因过度劳累导致生病，需要休息。",
                    effect: { health: -2.0, willpower: -1.0 },
                    icon: "fas fa-head-side-cough"
                },
                {
                    text: "信心受挫：在一次模拟考试中表现不佳，信心受打击。",
                    effect: { willpower: -2.0, relationship: -0.3 },
                    icon: "fas fa-sad-tear"
                }
            ],
            special: [
                {
                    text: "是否要走高考路线？家长担心竞赛耽误文化课，你需要成功说服。",
                    effect: { willpower: -1.0, relationship: -0.5 },
                    condition: () => gameState.year === 1 && gameState.month === 12,
                    requirement: () => gameState.relationship >= 6,
                    icon: "fas fa-balance-scale"
                },
                {
                    text: "学校要求参加额外活动，会占用训练时间。",
                    effect: { calculation: -0.3, insight: -0.3 },
                    condition: () => Math.random() < 0.3 && gameState.month === 10,
                    icon: "fas fa-calendar-times"
                },
                {
                    text: "有机会参加外省的高水平训练营，但需要额外费用和时间。",
                    effect: { calculation: 1.0, insight: 1.0, creativity: 0.5, willpower: -1.0 },
                    condition: () => gameState.year === 2 && gameState.month === 6 && Math.random() < 0.4,
                    icon: "fas fa-campground"
                }
            ]
        };

        // 对话场景定义
        const dialogueScenes = [
            {
                title: "月夜沉思",
                student: "cmo_UwU停下一直无意识转着笔的右手，抬头望向窗外。月光透过摇曳的树梢，在习题册上投下斑驳的光影。他声音很轻，像是怕惊扰了这静谧的夜：“教练，今晚月色真美。”\
他停顿了一下，指尖轻轻划过草稿纸上未完成的证明题，那些数学符号在月光下仿佛都有了生命。“我一直在思考，”他的声音更低了，“数学竞赛这条路真的适合我吗？”\
窗外一片梧桐叶子悄然飘落，他的目光追随着那片落叶，久久没有收回。“有时我感觉自己像在黑暗中摸索，”他的手指无意识地收紧，攥住了衣角，“连最近在做的拉格朗日插值，都感觉陌生得可怕……看不到前方的光亮。”\
他的声音渐渐消散在夜色中，只剩下习题册上未干的墨迹，在月光下泛着微光。",
                options: [
                    {
                        text: "数学如月，虽有阴晴圆缺，但总有光明之时。坚持下去，你会看到自己的光芒。",
                        correct: true,
                        response: "您说得对，教练。就像月亮总有圆满的一天，我也要相信自己的努力终会开花结果。"
                    },
                    {
                        text: "如果你觉得太难，可以考虑放弃，毕竟不是每个人都适合竞赛。",
                        correct: false,
                        response: "也许...也许我真的不够优秀..."
                    },
                    {
                        text: "别想那么多，专心做题就是了。",
                        correct: false,
                        response: "好的，教练。我会继续努力的。"
                    }
                ]
            },
            {
                title: "挫折之后",
                student: "cmo_UwU无精打采地推开办公室的门，手里的试卷被攥得发皱。他站在教练桌前，垂着头，声音轻得几乎听不见：“教练，这次的模拟考试我又没考好。”\
他将卷子平铺在桌面上，指尖点着最后两道大题的位置。那里的答题区几乎一片空白，只有几行写了又划掉的解题步骤，橡皮屑还黏在纸面上。\
“看着这些我做不出的题目，”他的声音有些发颤，“我感觉自己像个失败者。”\
窗外的夕阳斜照进来，把他映在试卷上的影子拉得很长。他盯着那道他苦思冥想了半小时却依然无解的函数题，密密麻麻的公式此刻像一团乱麻。\
“是不是我根本没有数学天赋？”他终于抬起头，眼圈微微发红，手指无意识地反复摩挲着试卷边缘，把那道压轴题的字迹都磨得模糊了。",
                options: [
                    {
                        text: "天赋如同种子，努力才是阳光雨露。没有坚持不懈的浇灌，再好的种子也无法开花。",
                        correct: true,
                        response: "谢谢教练，我明白了。我不该因为一时的挫折就否定自己，应该更加努力才是。"
                    },
                    {
                        text: "也许你真的没有天赋，不如早点放弃。",
                        correct: false,
                        response: "连教练您也这么认为吗...也许我真的应该放弃..."
                    },
                    {
                        text: "别想太多，下次考好就行了。",
                        correct: false,
                        response: "我会尽力而为的..."
                    }
                ]
            },
            {
                title: "孤独之路",
                student: "cmo_UwU将练习册合上，铅笔轻轻搁在草稿纸边缘。他望向窗外，操场上有三五个男生正追逐着篮球，夕阳把他们的影子拉得很长。远处传来隐约的欢笑声，像是隔着水传来。\n\
“教练，”他的声音很轻，像怕惊扰了桌上叠成小山的教辅资料，“有时候我觉得很孤独。”手指无意识地摩挲着写满公式的纸页，留下淡淡的汗渍。\n\
他的目光停在窗台那盆蔫了的绿萝上：“同学们都在享受青春——朋友圈里是烧烤摊的烟火气，电影院的新片，还有......”他顿了顿，“还有女孩子约会时拍的樱花。而我......”\n\
cmo_UwU低头看向自己右手，中指第一个关节处有块厚茧，是长期握笔留下的。桌角的咖啡已经凉了，表面凝着一层薄薄的油脂。\n\
“而我只能在题海里挣扎。”他扯了扯嘴角，“这些函数像潮水，一波未平一波又起。有时候半夜惊醒，满脑子都是没解完的几何题。”\n\
他突然抬起头，眼睛里有细碎的光在闪：“教练，为了一个未知的结果，值得吗？就像在黑暗的隧道里走了很久，却不知道尽头是不是真的有光。”\n\
窗外，最后一片晚霞正悄然隐没在教学楼的轮廓之后。",
                options: [
                    {
                        text: "登高望远者，必经孤独之路。那些看似平凡的坚持，终将铸就不凡的人生。",
                        correct: true,
                        response: "您说得对，教练。通往顶峰的道路总是孤独的，但我愿意为了梦想继续前行。"
                    },
                    {
                        text: "如果你觉得孤独，可以多和同学玩，少训练一点。",
                        correct: false,
                        response: "也许我真的应该放松一下..."
                    },
                    {
                        text: "这是你自己的选择，抱怨有什么用？",
                        correct: false,
                        response: "对不起，教练，我不该抱怨的..."
                    }
                ]
            },
            {
                title: "迷茫时刻",
                student: "cmo_UwU无意识地用指尖反复摩挲着草稿纸的边缘，纸张已被揉出细密的褶皱。他盯着桌上摊开的教科书，眼神却仿佛穿透了纸页，落在某个遥远的虚空。窗外的梧桐叶沙沙作响，阳光透过百叶窗在他脸上投下交替的光影。\n\
“教练，”他声音干涩，“我最近总是心不在焉。”他的手指无意识地画着一个无限符号，周而复始。\n\
他的目光移向那些密密麻麻的公式，瞳孔微微收缩。“看着这些公式和定理，”他停顿了一下，喉结轻轻滚动，“它们像迷宫里的高墙，每条推导路径都在眼前分岔，延伸向更深的迷雾。”摊开的笔记上，字迹从工整逐渐变得潦草，最后只剩下几道无意义的划痕。\n\
他终于抬起头，眼角泛着疲惫的红晕：“我是不是……从一开始就走错了路？”声音轻得像在问自己，手指却不由自主地收紧，将那张画满演算的纸捏成了一团。",
                options: [
                    {
                        text: "迷茫是成长的必经之路，正如黎明前的黑暗。坚持下去，你会找到属于自己的方向。",
                        correct: true,
                        response: "谢谢您的指引，教练。我会调整心态，继续前行的。"
                    },
                    {
                        text: "如果你觉得迷茫，那就休息一段时间吧。",
                        correct: false,
                        response: "也许我真的需要停下来好好想想..."
                    },
                    {
                        text: "别想那么多没用的，专心学习。",
                        correct: false,
                        response: "好的，教练。我会试着集中注意力的。"
                    }
                ]
            }
        ];

        // 竞赛定义
        const competitions = [
            {
                id: 'school',
                name: '校内选拔赛',
                month: 11,
                year: 1,
                requirements: { calculation: 5, insight: 4 },
                description: '这是学生面临的第一次正式挑战，需要展示出足够的能力才能进入校队。',
                success: { willpower: 1.5, relationship: 0.5 },
                failure: { willpower: -2.0 }
            },
            {
                id: 'city',
                name: '市级竞赛',
                month: 3,
                year: 1,
                requirements: { calculation: 5.5, insight: 4.5, creativity: 3.5 },
                description: '市级数学竞赛，优胜者将有机会参加省级联赛。',
                success: { willpower: 1.0, relationship: 0.3 },
                failure: { willpower: -1.0 }
            },
            {
                id: 'provincial1',
                name: '省级联赛（第一轮）',
                month: 5,
                year: 1,
                requirements: { calculation: 6, insight: 5, creativity: 4, logic: 4 },
                description: '省级数学联赛第一轮，竞争激烈，需要充分准备。',
                success: { willpower: 1.5, relationship: 0.5 },
                failure: { willpower: -1.5 }
            },
            {
                id: 'provincial2',
                name: '省级联赛（第二轮）',
                month: 9,
                year: 2,
                requirements: { calculation: 6.5, insight: 5.5, creativity: 4.5, logic: 4.5 },
                description: '省级数学联赛第二轮，难度更大，优胜者将进入全国联赛。',
                success: { willpower: 2.0, relationship: 0.8 },
                failure: { willpower: -2.0 }
            },
            {
                id: 'national',
                name: '全国高中数学联赛',
                month: 10,
                year: 2,
                requirements: { calculation: 7, insight: 6, creativity: 5, logic: 5, memory: 4 },
                description: '全国高中数学联赛，顶尖选手的竞技场。',
                success: { willpower: 2.5, relationship: 1.0 },
                failure: { willpower: -2.5 }
            },
            {
                id: 'cmo',
                name: '中国数学奥林匹克（CMO）',
                month: 11,
                year: 2,
                requirements: { calculation: 7.5, insight: 6.5, creativity: 5.5, logic: 5.5, memory: 4.5 },
                description: '中国数学奥林匹克，国家集训队的选拔赛。',
                success: { willpower: 3.0, relationship: 1.5 },
                failure: { willpower: -3.0 }
            },
            {
                id: 'team',
                name: '国家队选拔',
                month: 3,
                year: 3,
                requirements: { calculation: 8.5, insight: 7.5, creativity: 6.5, logic: 6.5, memory: 5.5, willpower: 6 },
                description: '国际数学奥林匹克中国国家队选拔，只有最优秀的6名选手能够入选。',
                success: { willpower: 4.0, relationship: 2.0 },
                failure: { willpower: -4.0 }
            },
            {
                id: 'imo',
                name: '国际数学奥林匹克（IMO）',
                month: 7,
                year: 3,
                requirements: { calculation: 9, insight: 8, creativity: 7, logic: 7, memory: 6, willpower: 7 },
                description: '国际数学奥林匹克，世界最高水平的中学生数学竞赛。',
                success: { willpower: 5.0, relationship: 3.0 },
                failure: { willpower: -5.0 }
            }
        ];

        // DOM元素
        const timeDisplay = document.getElementById('time-display');
        const calculationValue = document.getElementById('calculation-value');
        const insightValue = document.getElementById('insight-value');
        const creativityValue = document.getElementById('creativity-value');
        const logicValue = document.getElementById('logic-value');
        const memoryValue = document.getElementById('memory-value');
        const willpowerDisplay = document.getElementById('willpower-display');
        const healthDisplay = document.getElementById('health-display');
        const trainingIntensityDisplay = document.getElementById('training-intensity');
        const relationshipDisplay = document.getElementById('relationship-value');
        const calculationFill = document.getElementById('calculation-fill');
        const insightFill = document.getElementById('insight-fill');
        const creativityFill = document.getElementById('creativity-fill');
        const logicFill = document.getElementById('logic-fill');
        const memoryFill = document.getElementById('memory-fill');
        const actionButton = document.getElementById('action-button');
        const eventLog = document.getElementById('event-log');
        const gameOverScreen = document.getElementById('game-over');
        const gameResult = document.getElementById('game-result');
        const gameDescription = document.getElementById('game-description');
        const restartButton = document.getElementById('restart-button');
        const nextCompetitionDisplay = document.getElementById('next-competition');
        const competitionRequirementsDisplay = document.getElementById('competition-requirements');

        // 弹窗元素
        const actionModal = document.getElementById('action-modal');
        const resultModal = document.getElementById('result-modal');
        const competitionModal = document.getElementById('competition-modal');
        const dialogueModal = document.getElementById('dialogue-modal');
        const actionGrid = document.getElementById('action-grid');
        const confirmActionsButton = document.getElementById('confirm-actions');
        const resultContent = document.getElementById('result-content');
        const continueButton = document.getElementById('continue-button');
        const competitionContent = document.getElementById('competition-content');
        const competitionTitle = document.getElementById('competition-title');
        const competitionContinueButton = document.getElementById('competition-continue');
        const dialogueContent = document.getElementById('dialogue-content');

        // 初始化游戏
        function initGame() {
            updateDisplay();
            setupEventListeners();
            generateActionCards();
            updateNextCompetition();
        }

        // 更新显示
        function updateDisplay() {
            // 更新时间显示
            const yearText = gameState.year === 1 ? "高一" : gameState.year === 2 ? "高二" : "高三";
            const semester = gameState.month >= 9 || gameState.month <= 2 ? "上" : "下";
            timeDisplay.textContent = `${yearText}${semester}学期 ${gameState.month}月`;

            // 更新属性值，保留一位小数
            calculationValue.textContent = gameState.calculation.toFixed(1);
            insightValue.textContent = gameState.insight.toFixed(1);
            creativityValue.textContent = gameState.creativity.toFixed(1);
            logicValue.textContent = gameState.logic.toFixed(1);
            memoryValue.textContent = gameState.memory.toFixed(1);
            willpowerDisplay.textContent = gameState.willpower.toFixed(1);
            healthDisplay.textContent = gameState.health.toFixed(1);
            trainingIntensityDisplay.textContent = gameState.trainingIntensity.toFixed(1);
            relationshipDisplay.textContent = gameState.relationship.toFixed(1);

            // 更新属性条
            calculationFill.style.width = `${gameState.calculation * 10}%`;
            insightFill.style.width = `${gameState.insight * 10}%`;
            creativityFill.style.width = `${gameState.creativity * 10}%`;
            logicFill.style.width = `${gameState.logic * 10}%`;
            memoryFill.style.width = `${gameState.memory * 10}%`;

            // 更新阶段指示器
            updatePhaseIndicator();

            // 更新里程碑
            updateMilestones();

            // 更新教练技能按钮状态
            updateCoachButtons();

            // 更新下一个比赛信息
            updateNextCompetition();
        }

        // 更新下一个比赛信息
        function updateNextCompetition() {
            const nextComp = getNextCompetition();
            if (nextComp) {
                nextCompetitionDisplay.textContent = `${nextComp.name} - ${nextComp.month}月`;

                let requirementsText = "要求：";
                const reqs = [];
                if (nextComp.requirements.calculation) reqs.push(`计算力 ≥ ${nextComp.requirements.calculation}`);
                if (nextComp.requirements.insight) reqs.push(`洞察力 ≥ ${nextComp.requirements.insight}`);
                if (nextComp.requirements.creativity) reqs.push(`创造力 ≥ ${nextComp.requirements.creativity}`);
                if (nextComp.requirements.logic) reqs.push(`逻辑思维 ≥ ${nextComp.requirements.logic}`);
                if (nextComp.requirements.memory) reqs.push(`记忆力 ≥ ${nextComp.requirements.memory}`);
                if (nextComp.requirements.willpower) reqs.push(`意志力 ≥ ${nextComp.requirements.willpower}`);

                requirementsText += reqs.join("，");
                competitionRequirementsDisplay.textContent = requirementsText;
            } else {
                nextCompetitionDisplay.textContent = "暂无比赛";
                competitionRequirementsDisplay.textContent = "";
            }
        }

        // 获取下一个比赛
        function getNextCompetition() {
            for (const comp of competitions) {
                if (comp.year === gameState.year && comp.month === gameState.month) {
                    return comp;
                }
            }

            // 如果本月没有比赛，找下一个比赛
            for (const comp of competitions) {
                if (comp.year > gameState.year || (comp.year === gameState.year && comp.month > gameState.month)) {
                    return comp;
                }
            }

            return null;
        }

        // 更新阶段指示器
        function updatePhaseIndicator() {
            const phases = document.querySelectorAll('.phase');
            phases.forEach((phase, index) => {
                phase.classList.remove('active', 'completed');

                if (index + 1 < gameState.year) {
                    phase.classList.add('completed');
                } else if (index + 1 === gameState.year) {
                    phase.classList.add('active');
                }
            });
        }

        // 更新里程碑
        function updateMilestones() {
            const milestones = document.querySelectorAll('.milestone');
            milestones[0].classList.toggle('completed', gameState.milestones.school);
            milestones[1].classList.toggle('completed', gameState.milestones.city);
            milestones[2].classList.toggle('completed', gameState.milestones.provincial);
            milestones[3].classList.toggle('completed', gameState.milestones.national);
            milestones[4].classList.toggle('completed', gameState.milestones.cmo);
            milestones[5].classList.toggle('completed', gameState.milestones.team);
            milestones[6].classList.toggle('completed', gameState.milestones.imo);
        }

        // 更新教练技能按钮状态
        function updateCoachButtons() {
            document.getElementById('coach-training').disabled = gameState.coachActionsUsed.training;
            document.getElementById('coach-mindset').disabled = gameState.coachActionsUsed.mindset;
            document.getElementById('coach-analysis').disabled = gameState.coachActionsUsed.analysis;
            document.getElementById('coach-rest').disabled = gameState.coachActionsUsed.rest;
        }

        // 生成行动卡片
        function generateActionCards() {
            actionGrid.innerHTML = '';

            actions.forEach(action => {
                const card = document.createElement('div');
                card.className = 'action-card';
                card.dataset.action = action.id;

                card.innerHTML = `
                    <h4><i class="${action.icon}"></i> ${action.name}</h4>
                    <p>${action.description}</p>
                    <div class="intensity"><i class="fas fa-fire"></i> 训练强度: ${action.intensity}/10</div>
                `;

                card.addEventListener('click', () => {
                    if (card.classList.contains('selected')) {
                        card.classList.remove('selected');
                        gameState.selectedActions = gameState.selectedActions.filter(a => a !== action.id);
                    } else {
                        if (gameState.selectedActions.length < 2) {
                            card.classList.add('selected');
                            gameState.selectedActions.push(action.id);
                        }
                    }

                    confirmActionsButton.disabled = gameState.selectedActions.length === 0;
                });

                actionGrid.appendChild(card);
            });
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 行动按钮点击事件
            actionButton.addEventListener('click', function () {
                if (!gameState.gameActive) return;
                actionModal.style.display = 'flex';
                gameState.selectedActions = [];
                document.querySelectorAll('.action-card').forEach(card => {
                    card.classList.remove('selected');
                });
                confirmActionsButton.disabled = true;
            });

            // 关闭行动选择弹窗
            document.getElementById('close-action-modal').addEventListener('click', function () {
                actionModal.style.display = 'none';
            });

            // 确认行动选择
            confirmActionsButton.addEventListener('click', function () {
                actionModal.style.display = 'none';
                processMonth();
            });

            // 继续按钮（月度结果弹窗）
            continueButton.addEventListener('click', function () {
                resultModal.style.display = 'none';
            });

            // 继续按钮（竞赛结果弹窗）
            competitionContinueButton.addEventListener('click', function () {
                competitionModal.style.display = 'none';
            });

            // 关闭对话弹窗
            document.getElementById('close-dialogue-modal').addEventListener('click', function () {
                dialogueModal.style.display = 'none';
            });

            // 教练技能按钮
            document.getElementById('coach-training').addEventListener('click', function () {
                useCoachAction('training');
            });

            document.getElementById('coach-mindset').addEventListener('click', function () {
                useCoachAction('mindset');
            });

            document.getElementById('coach-analysis').addEventListener('click', function () {
                useCoachAction('analysis');
            });

            document.getElementById('coach-rest').addEventListener('click', function () {
                useCoachAction('rest');
            });

            // 重新开始按钮
            restartButton.addEventListener('click', restartGame);
        }

        // 处理月份进展
        function processMonth() {
            if (!gameState.gameActive) return;

            const monthlyResults = {
                actions: [],
                events: [],
                attributeChanges: {
                    calculation: 0,
                    insight: 0,
                    creativity: 0,
                    logic: 0,
                    memory: 0,
                    willpower: 0,
                    health: 0,
                    relationship: 0
                },
                intensityChange: 0
            };

            // 计算训练强度
            let totalIntensity = 0;
            gameState.selectedActions.forEach(actionId => {
                const action = actions.find(a => a.id === actionId);
                totalIntensity += action.intensity;
            });

            const avgIntensity = totalIntensity / gameState.selectedActions.length;
            monthlyResults.intensityChange = avgIntensity - gameState.trainingIntensity;
            gameState.trainingIntensity = Math.max(1, Math.min(10, gameState.trainingIntensity * 0.7 + avgIntensity * 0.3));

            // 应用行动效果
            gameState.selectedActions.forEach(actionId => {
                const action = actions.find(a => a.id === actionId);

                // 根据训练强度调整效果
                const intensityFactor = gameState.trainingIntensity / 5;
                const adjustedEffects = {};
                for (const [key, value] of Object.entries(action.effects)) {
                    adjustedEffects[key] = value * intensityFactor;
                }

                // 根据健康值和意志力调整效果
                const healthFactor = gameState.health / 10;
                const willpowerFactor = gameState.willpower / 10;
                const overallFactor = (healthFactor + willpowerFactor) / 2;

                for (const [key, value] of Object.entries(adjustedEffects)) {
                    if (value > 0) {
                        adjustedEffects[key] = value * overallFactor;
                    }
                }

                applyEffects(adjustedEffects, monthlyResults.attributeChanges);

                // 记录行动结果
                monthlyResults.actions.push({
                    name: action.name,
                    effects: adjustedEffects
                });

                addEventLog(`执行了${action.name}`, 'normal', 'fas fa-running');
            });

            // 触发随机事件
            const event = triggerRandomEvent();
            if (event) {
                applyEffects(event.effect, monthlyResults.attributeChanges);
                monthlyResults.events.push(event);
                addEventLog(event.text, event.type, event.icon);
            }

            // 自然属性变化
            const naturalChanges = {
                willpower: -0.2,
                health: -0.1
            };

            // 高强度训练会增加自然衰减
            if (gameState.trainingIntensity > 7) {
                naturalChanges.willpower -= 0.3;
                naturalChanges.health -= 0.2;
            }

            // 低强度训练会减少自然衰减
            if (gameState.trainingIntensity < 3) {
                naturalChanges.willpower += 0.2;
                naturalChanges.health += 0.2;
            }

            applyEffects(naturalChanges, monthlyResults.attributeChanges);

            // 检查竞赛
            const competitionResult = checkCompetitions();
            if (competitionResult) {
                monthlyResults.competition = competitionResult;
            }

            // 推进时间
            advanceTime();

            // 更新显示
            updateDisplay();

            // 显示月度结果弹窗
            showMonthlyResults(monthlyResults);


            // 检查健康警告
            if (gameState.health < 3) {
                addEventLog("警告：学生的健康状况不佳，请考虑减少训练强度或安排休息！", "negative", "fas fa-exclamation-triangle");
            }

            // 检查是否触发对话
            if (gameState.willpower < 0.1 && !gameState.dialogueTriggered) {
                triggerDialogue();
            } else if (gameState.willpower < 3) {
                // 检查游戏结束条件
                checkGameEnd();
                addEventLog("警告：学生的意志力很低，可能会影响训练效果和比赛表现！", "negative", "fas fa-exclamation-triangle");
            }

        }

        // 触发对话
        function triggerDialogue() {
            // 标记对话已触发
            gameState.dialogueTriggered = true;

            // 随机选择一个对话场景
            const scene = dialogueScenes[Math.floor(Math.random() * dialogueScenes.length)];

            // 构建对话内容
            let dialogueHTML = `
                <div class="dialogue-container">
                    <div class="dialogue-box">
                        <div class="dialogue-speaker"><i class="fas fa-user-graduate"></i> cmo_UwU</div>
                        <div class="dialogue-content">${scene.student}</div>
                    </div>
                    <div class="dialogue-options">
            `;

            // 添加选项
            scene.options.forEach((option, index) => {
                dialogueHTML += `
                    <button class="dialogue-option" data-index="${index}" data-correct="${option.correct}">
                        ${option.text}
                    </button>
                `;
            });

            dialogueHTML += `</div></div>`;

            dialogueContent.innerHTML = dialogueHTML;
            dialogueModal.style.display = 'flex';

            // 为选项添加事件监听器
            document.querySelectorAll('.dialogue-option').forEach(option => {
                option.addEventListener('click', function () {
                    const isCorrect = this.dataset.correct === 'true';
                    const index = parseInt(this.dataset.index);
                    const response = scene.options[index].response;

                    // 显示学生的回应
                    let responseHTML = `
                        <div class="dialogue-container">
                            <div class="dialogue-box">
                                <div class="dialogue-speaker"><i class="fas fa-user-graduate"></i> cmo_UwU</div>
                                <div class="dialogue-content">${response}</div>
                            </div>
                    `;

                    if (isCorrect) {
                        // 正确回答，重置意志力
                        gameState.willpower = 5.0;
                        responseHTML += `
                            <div class="dialogue-box" style="border-left-color: var(--success);">
                                <div class="dialogue-speaker"><i class="fas fa-chalkboard-teacher"></i> 教练</div>
                                <div class="dialogue-content">你的理解让我感到欣慰。记住，真正的强者不是没有眼泪的人，而是含着眼泪依然奔跑的人。</div>
                            </div>
                            <div style="text-align: center; margin-top: 20px;">
                                <p class="positive">cmo_UwU的意志力恢复了！</p>
                            </div>
                        `;
                        addEventLog("通过一次深入的对话，cmo_UwU重新找回了信心，意志力得到了恢复。", "positive", "fas fa-comments");
                    } else {
                        // 错误回答
                        responseHTML += `
                            <div class="dialogue-box" style="border-left-color: var(--danger);">
                                <div class="dialogue-speaker"><i class="fas fa-chalkboard-teacher"></i> 教练</div>
                                <div class="dialogue-content">看来你还需要时间思考。记住，成长的道路上难免会有迷茫，但不要轻易放弃。</div>
                            </div>
                        `;
                        addEventLog("对话未能达到预期效果，cmo_UwU的意志力问题仍未解决。", "negative", "fas fa-comments");
                        // 检查游戏结束条件
                        checkGameEnd();
                    }

                    responseHTML += `
                        <div class="modal-footer">
                            <button class="modal-button primary" id="close-dialogue">继续</button>
                        </div>
                    </div>
                    `;

                    dialogueContent.innerHTML = responseHTML;

                    // 为继续按钮添加事件监听器
                    document.getElementById('close-dialogue').addEventListener('click', function () {
                        dialogueModal.style.display = 'none';
                        updateDisplay();
                    });
                });
            });
        }

        // 应用效果
        function applyEffects(effects, attributeChanges) {
            if (effects.calculation) {
                gameState.calculation = Math.max(0, gameState.calculation + effects.calculation);
                attributeChanges.calculation += effects.calculation;
            }
            if (effects.insight) {
                gameState.insight = Math.max(0, gameState.insight + effects.insight);
                attributeChanges.insight += effects.insight;
            }
            if (effects.creativity) {
                gameState.creativity = Math.max(0, gameState.creativity + effects.creativity);
                attributeChanges.creativity += effects.creativity;
            }
            if (effects.logic) {
                gameState.logic = Math.max(0, gameState.logic + effects.logic);
                attributeChanges.logic += effects.logic;
            }
            if (effects.memory) {
                gameState.memory = Math.max(0, gameState.memory + effects.memory);
                attributeChanges.memory += effects.memory;
            }
            if (effects.willpower) {
                gameState.willpower = Math.max(0, Math.min(10, gameState.willpower + effects.willpower));
                attributeChanges.willpower += effects.willpower;
            }
            if (effects.health) {
                gameState.health = Math.max(0, Math.min(10, gameState.health + effects.health));
                attributeChanges.health += effects.health;
            }
            if (effects.relationship) {
                gameState.relationship = Math.max(0, Math.min(10, gameState.relationship + effects.relationship));
                attributeChanges.relationship += effects.relationship;
            }
        }

        // 触发随机事件
        function triggerRandomEvent() {
            // 决定事件类型
            const rand = Math.random();
            let eventType;

            if (rand < 0.35) {
                eventType = 'positive';
            } else if (rand < 0.7) {
                eventType = 'negative';
            } else {
                eventType = 'special';
            }

            // 从对应类型中随机选择事件
            const events = randomEvents[eventType];
            const event = events[Math.floor(Math.random() * events.length)];

            // 检查特殊事件条件
            if (eventType === 'special' && event.condition && !event.condition()) {
                return null; // 条件不满足，不触发事件
            }

            // 检查特殊事件要求
            if (eventType === 'special' && event.requirement && !event.requirement()) {
                addEventLog("特殊事件处理失败：未能满足要求！", "negative", "fas fa-times-circle");
                return {
                    text: event.text + " (处理失败)",
                    effect: event.effect,
                    type: "negative",
                    icon: "fas fa-times-circle"
                };
            }

            return {
                text: event.text,
                effect: event.effect,
                type: eventType,
                icon: event.icon
            };
        }

        // 添加事件日志
        function addEventLog(text, type, icon) {
            const eventEntry = document.createElement('div');
            eventEntry.className = `event-entry ${type}`;
            eventEntry.innerHTML = `
                <div class="event-icon"><i class="${icon}"></i></div>
                <div>${text}</div>
            `;
            eventLog.appendChild(eventEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // 检查竞赛
        function checkCompetitions() {
            let result = null;

            for (const comp of competitions) {
                if (comp.year === gameState.year && comp.month === gameState.month && !gameState.milestones[comp.id]) {
                    const success = checkCompetitionRequirements(comp);

                    if (success) {
                        gameState.milestones[comp.id] = true;
                        result = {
                            title: comp.name + "结果",
                            content: `恭喜！cmo_UwU在${comp.name}中表现出色，成功晋级！`,
                            type: "success",
                            effects: comp.success
                        };
                        addEventLog(result.content, "positive", "fas fa-trophy");

                        // 应用成功效果
                        applyEffects(comp.success, {});
                    } else {
                        result = {
                            title: comp.name + "结果",
                            content: `很遗憾，cmo_UwU在${comp.name}中表现不佳，未能达到预期目标。`,
                            type: "failure",
                            effects: comp.failure
                        };
                        addEventLog(result.content, "negative", "fas fa-times");

                        // 应用失败效果
                        applyEffects(comp.failure, {});

                        // 某些关键比赛失败会导致游戏结束
                        if (gameState.year == 3 && (comp.id === 'school' || comp.id === 'imo')) {
                            let endMessage = "";
                            let endDescription = "";

                            if (comp.id === 'school') {
                                endMessage = "遗憾退场";
                                endDescription = "学生在校内选拔赛折戟，未能进入校队，竞赛之路就此结束。";
                            } else if (comp.id === 'imo') {
                                endMessage = "功勋教练";
                                endDescription = "学生在IMO中获得银牌，表现卓越但未能获得金牌！";
                            }

                            endGame(endMessage, endDescription);
                        }
                    }

                    showCompetitionResult(result, comp);
                    break;
                }
            }

            return result;
        }

        // 检查竞赛要求
        function checkCompetitionRequirements(comp) {
            let meetRequirements = true;

            if (comp.requirements.calculation && gameState.calculation < comp.requirements.calculation) {
                meetRequirements = false;
            }
            if (comp.requirements.insight && gameState.insight < comp.requirements.insight) {
                meetRequirements = false;
            }
            if (comp.requirements.creativity && gameState.creativity < comp.requirements.creativity) {
                meetRequirements = false;
            }
            if (comp.requirements.logic && gameState.logic < comp.requirements.logic) {
                meetRequirements = false;
            }
            if (comp.requirements.memory && gameState.memory < comp.requirements.memory) {
                meetRequirements = false;
            }
            if (comp.requirements.willpower && gameState.willpower < comp.requirements.willpower) {
                meetRequirements = false;
            }

            // 添加随机因素（健康、意志力、关系等会影响表现）
            const randomFactor = 0.8 + Math.random() * 0.4; // 0.8 - 1.2
            const healthFactor = gameState.health / 10;
            const willpowerFactor = gameState.willpower / 10;
            const relationshipFactor = gameState.relationship / 10;
            const overallFactor = (healthFactor + willpowerFactor + relationshipFactor) / 3;

            return meetRequirements && (randomFactor * overallFactor > 0.7);
        }

        // 显示竞赛结果
        function showCompetitionResult(result, comp) {
            competitionTitle.textContent = result.title;

            let contentHTML = `
                <p>${result.content}</p>
                <p><strong>比赛描述：</strong>${comp.description}</p>
                <div style="text-align: center; margin-top: 20px;">
                    <h3>${result.type === "success" ? "🎉 恭喜！" : "😔 很遗憾..."}</h3>
                </div>
            `;

            if (result.type === "failure") {
                contentHTML += `
                    <div class="warning">
                        <p><strong>分析：</strong>学生的能力尚未达到比赛要求，需要继续努力提升。</p>
                    </div>
                `;
            }

            competitionContent.innerHTML = contentHTML;
            competitionModal.style.display = 'flex';
        }

        // 推进时间
        function advanceTime() {
            gameState.month++;

            // 学年转换
            if (gameState.month > 12) {
                gameState.month = 1;
                gameState.year++;

                // 重置教练技能
                gameState.coachActionsUsed.training = false;
                gameState.coachActionsUsed.mindset = false;
                gameState.coachActionsUsed.analysis = false;
                gameState.coachActionsUsed.rest = false;

                addEventLog(`新的学年开始了！现在是高${gameState.year}。`, "special", "fas fa-calendar-alt");
            }
        }

        // 显示月度结果
        function showMonthlyResults(results) {
            let html = `
                <h3>本月训练成果</h3>
                <p>时间：${timeDisplay.textContent}</p>
                <p>训练强度变化: ${results.intensityChange > 0 ? '+' : ''}${results.intensityChange.toFixed(1)}</p>
            `;

            // 显示行动结果
            if (results.actions.length > 0) {
                html += `<h4>训练项目：</h4><ul>`;
                results.actions.forEach(action => {
                    html += `<li>${action.name}</li>`;
                });
                html += `</ul>`;
            }

            // 显示随机事件
            if (results.events.length > 0) {
                html += `<h4>本月事件：</h4>`;
                results.events.forEach(event => {
                    html += `<p class="${event.type}"><i class="${event.icon}"></i> ${event.text}</p>`;
                });
            }

            // 显示属性变化
            html += `<h4>属性变化：</h4><div class="result-grid">`;

            if (results.attributeChanges.calculation !== 0) {
                const changeClass = results.attributeChanges.calculation > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.calculation > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>计算力</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.calculation.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.insight !== 0) {
                const changeClass = results.attributeChanges.insight > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.insight > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>洞察力</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.insight.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.creativity !== 0) {
                const changeClass = results.attributeChanges.creativity > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.creativity > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>创造力</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.creativity.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.logic !== 0) {
                const changeClass = results.attributeChanges.logic > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.logic > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>逻辑思维</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.logic.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.memory !== 0) {
                const changeClass = results.attributeChanges.memory > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.memory > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>记忆力</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.memory.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.willpower !== 0) {
                const changeClass = results.attributeChanges.willpower > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.willpower > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>意志力</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.willpower.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.health !== 0) {
                const changeClass = results.attributeChanges.health > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.health > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>健康值</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.health.toFixed(1)}</div>
                    </div>
                `;
            }

            if (results.attributeChanges.relationship !== 0) {
                const changeClass = results.attributeChanges.relationship > 0 ? 'positive' : 'negative';
                const changeSymbol = results.attributeChanges.relationship > 0 ? '+' : '';
                html += `
                    <div class="result-card ${changeClass}">
                        <div>师生关系</div>
                        <div class="result-value ${changeClass}">${changeSymbol}${results.attributeChanges.relationship.toFixed(1)}</div>
                    </div>
                `;
            }

            html += `</div>`;

            resultContent.innerHTML = html;
            resultModal.style.display = 'flex';
        }

        // 使用教练技能
        function useCoachAction(action) {
            if (gameState.coachActionsUsed[action]) {
                alert("这个技能本学期已经使用过了。");
                return;
            }

            gameState.coachActionsUsed[action] = true;

            let message = "";
            let effects = {};

            switch (action) {
                case 'training':
                    const attributes = ['calculation', 'insight', 'creativity', 'logic', 'memory'];
                    const attribute = attributes[Math.floor(Math.random() * attributes.length)];
                    effects[attribute] = 2;
                    message = `进行了一对一特训，${getAttributeName(attribute)}大幅提升！`;
                    break;
                case 'mindset':
                    effects.willpower = 3;
                    effects.relationship = 1;
                    message = "进行了心态调整，学生的意志力大幅恢复，师生关系更加融洽！";
                    break;
                case 'analysis':
                    // 战术分析效果会在下次竞赛中体现
                    message = "进行了战术分析，下次竞赛成绩将会提升！";
                    // 这里可以添加一个标记，在下次竞赛时使用
                    break;
                case 'rest':
                    effects.willpower = 2;
                    effects.health = 3;
                    effects.trainingIntensity = -3;
                    message = "安排了强制休息，学生的健康值和意志力得到恢复，训练强度降低。";
                    break;
            }

            applyEffects(effects, {});
            addEventLog(message, "positive", "fas fa-magic");
            updateDisplay();

            // 显示教练技能使用结果
            showCoachActionResult(action, message);
        }

        // 显示教练技能使用结果
        function showCoachActionResult(action, message) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';

            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">教练技能使用</h2>
                        <button class="close-button" onclick="this.parentElement.parentElement.parentElement.style.display='none'">&times;</button>
                    </div>
                    <div class="modal-body">
                        <p>${message}</p>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-button primary" onclick="this.parentElement.parentElement.parentElement.style.display='none'">确定</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // 获取属性名称
        function getAttributeName(attribute) {
            const names = {
                calculation: "计算力",
                insight: "洞察力",
                creativity: "创造力",
                logic: "逻辑思维",
                memory: "记忆力"
            };
            return names[attribute] || attribute;
        }

        // 检查游戏结束
        function checkGameEnd() {
            if (gameState.year > 3) {
                endGame("时间结束", "三年高中时光已结束，学生毕业离校。");
            }

            if (gameState.health <= 0) {
                endGame("健康问题", "学生因健康问题不得不退出竞赛训练。");
            }

            if (gameState.willpower <= 0) {
                endGame("意志崩溃", "学生因意志力崩溃放弃了竞赛之路。");
            }

            if (gameState.relationship <= 0) {
                endGame("关系破裂", "师生关系破裂，无法继续指导。");
            }
        }

        // 结束游戏
        function endGame(result, description) {
            gameState.gameActive = false;
            gameResult.textContent = result;
            gameDescription.textContent = description;
            gameOverScreen.style.display = 'block';

            // 禁用行动按钮
            actionButton.disabled = true;
        }

        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            Object.assign(gameState, {
                year: 1,
                month: 9,
                calculation: 4,
                insight: 3,
                creativity: 2,
                logic: 2.5,
                memory: 3.5,
                willpower: 5,
                health: 8,
                trainingIntensity: 5,
                relationship: 7,
                selectedActions: [],
                coachActionsUsed: {
                    training: false,
                    mindset: false,
                    analysis: false,
                    rest: false
                },
                milestones: {
                    school: false,
                    city: false,
                    provincial: false,
                    national: false,
                    cmo: false,
                    team: false,
                    imo: false
                },
                gameActive: true,
                competitionResults: [],
                dialogueTriggered: false
            });

            // 清空事件日志
            eventLog.innerHTML = `
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-info-circle"></i></div>
                    <div>欢迎来到金牌教练模拟器！你接收了一位有潜力的高一学生cmo_UwU，请开始你的教练生涯。</div>
                </div>
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-bullseye"></i></div>
                    <div>目标：在三年内培养出一位IMO金牌选手。</div>
                </div>
                <div class="event-entry">
                    <div class="event-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div>注意：学生的健康值和意志力会影响训练效果，请合理安排训练和休息。</div>
                </div>
            `;

            // 隐藏游戏结束屏幕
            gameOverScreen.style.display = 'none';

            // 启用行动按钮
            actionButton.disabled = false;

            // 更新显示
            updateDisplay();
        }

        // 初始化游戏
        initGame();
    </script>
</body>

</html>